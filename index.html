<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="iuu,jonah,哎呦呦,子非鱼安知鱼之乐">
  
  
    <meta name="description" content="子非鱼，安知鱼之乐。">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    iUU</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay loop muted data-autoplay="" poster="/images/ocean/ocean.png" x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">iUU</a></h1>
      <p>子非鱼，安知鱼之乐。</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="iUU"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
      
        <article id="post-123" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/123/">123</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/123/" class="article-date">
  <time datetime="2019-05-15T09:30:28.000Z" itemprop="datePublished">2019-05-15</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/123/" data-id="cjvp22zyf0000somhv57ntdpw" class="article-share-link">Share</a>
      
    </footer>

  </div>

  

  

</article>



      
        <article id="post-hello-world" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/hello-world/">Hello World</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/hello-world/" class="article-date">
  <time datetime="2019-02-11T05:25:02.836Z" itemprop="datePublished">2019-02-11</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/hello-world/" data-id="cjvp22zyr0008somh8bpqr1i2" class="article-share-link">Share</a>
      
    </footer>

  </div>

  

  

</article>



      
        <article id="post-progammer" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/progammer/">浅谈那些程序员面试的热门话题</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/progammer/" class="article-date">
  <time datetime="2018-11-06T06:39:31.000Z" itemprop="datePublished">2018-11-06</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Moment/">Moment</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/11/progammer-1024x680.jpeg" alt=""> 近来看到一篇很棒的文章，相信对各位同僚有很大的帮助和启发。 转载自至简书 - 猿_员 <a href="https://www.jianshu.com/p/6eda130e239d" target="_blank" rel="noopener">传送门</a> 我自己从08年实习以来，先后经历了几家软件公司，全部是外企，其中有世界500强的通信企业，有从事期权期货交易的欧洲中等规模的金融公司，也有为新兴公司开发iOS。跨入IT行业以来，我在求职过程中经历过多次面试，最近两年也有过多次面试别人的经验。我感觉现在到了对这个问题发表自己看法的时候，这篇文章是我站在面试官角度 对于程序员面试问题的一个阶段性反思和经验总结。 目标 相信和不少朋友一样，有了几年工作经验成为Senior后就开始了面试别人的经历。我在最初这个阶段只是按照自己的想象把”找到基础好的程序员“，”找到A<em>算法能力优秀的程序员“，”找到有iOS开发经验的程序员“等作为面试的目标。但是，实际的经历告诉我，尤其是按“基础好”，“算法好”这些目标招到的人最终效果并不好。比如，有的面试者基础知识和算法掌握情况不错，进程、线程、内存等概念清晰，基本的Hash，二叉树，快速排序等数据结构和算法也比较熟悉，但是进公司后在实际工作中表现得很糟糕。后来，我才发现原来是我的面试目标出了问题，我原先的面试方法更像是大学的算法或操作系统期末考试，按照这种方法让许多并不合适的人通过了面试，同时也可能错过了许多合适的人。 后来，我的反思是，从公司的角度讲，面试的根本目的是找到”能够干好工作” 的人，而“高学历”，“算法好”，“基础好”，“有经验”这些都是表象而不是根本，它们并不能直接和“工作好”划等号。 <strong>方法</strong> 目标明确了，但接下来的问题是假设面试者是一个黑盒系统，“工作好”不是直接可观测变量，你所能直接观测的变量是基础、算法、经验、学历、性格、谈吐、年龄等等。所以，实际上，你只能从“基础好”，“算法好”等可以直接观测的量去推测“工作好”的概率，这就是一个在“X好“条件下”工作好“的条件概率问题：P(工作好 | X好) 。 根据这个模型，面试所应该考察哪些方面就很明显了，那就是选择那种最具有区分性的方面来考察。比如，考察面试者的体型特征没有太大意义，因为P(工作好|高)，P(工作好|矮)，P(工作好|胖)，P(工作好|瘦)的概率都差不多;所以，体型特征不具有区分性，这不是面试所应该关注的内容。 面试官应当结合职位的要求明确哪些因素具有比较好的区分性 。比如，如果要招一名技术门槛比较高的3D游戏引擎开发工程师，面试者A具有3D游戏引擎开发的经验，但是在基础知识和算法面试方面表现一般;面试者B相反，基础知识和算法面试表现很好，但没有游戏开发经验，而你只能选择其一。你选谁呢?其实，这就是两个条件概率问题P(工作好|经验好，基础一般，算法一般)和P(工作好|没经验，基础好，算法好)。这个问题就留给面试官来判断了，就我个人而言，对于技术门槛较高需要技术积累的职位，经验更加说明问题，因此，我更倾向于面试者A。 下面，我再结合自己的经验谈谈对面试中常见方面的看法。 <strong>算法</strong> 算法是Google和MS等大公司面试所重点考察的内容。我个人很喜欢算法，曾经参加ACM/ICPC拿过北京赛区的13名。但是，就个人经验来看，我所接触过的绝大多数开发职位而言，算法都不适合作为考察面试者优劣的主要因素。对于普通的非算法性开发职位，考察面试者的算法就相当于考察他打乒乓球好不好一样，与目标“工作好”的相关性太低。就我个人的经验来看，差不多P(工作好|算法好)=50% ，也就是算法面试没有太大的区分性。 甚至，还有一种很不好的情况特别多地出现在算法好的面试者身上，我称之为“只磨刀，不砍柴”。什么意思呢?有类人只对什么A</em>算法，异步编程，JVM类加载机制这种纯技术问题感兴趣，对实现用户需求毫无兴趣。这类人看起来有一定的技术能力，但是对公司来讲贡献十分有限，甚至不如技术一般但认真负责的人。所以，一旦遇到面试者算法好，我就特别留意考察会不会是这种“只磨刀，不砍柴”的人。 另外，虽然我个人不了解Google和MS，但我对于其特别重视考察算法能力的面试策略是持怀疑态度的。即使在这样的世界级大公司，算法虽然重要，但可以想象在项目实施过程所遇到的各种各样问题中，算法问题绝大多数时候不会是主要瓶颈，没有到那种需要每个人都是算法高手的情况。实际上，绝大多数项目真正难点并不是一两个算法瓶颈，甚至也不是单点的技术瓶颈，而是系统性的组织、协调、设计、开发问题，有大量的看起来不是那么有技术含量的脏活累活，也有许多问题是由于信息不足，并不是技术能力强就能克服这些困难。一个团队最好优势互补，有人算法强，有人业务分析能力强，有人擅长后端服务，有人擅长前端界面，有人聪明，有人踏实，这是最好的。如果按照“算法好”的单一标准选材，必定会把许多优秀的人才拒之门外。 <strong>基础</strong> 基础面试是指考察诸如指针使用、进程线程概念等基础知识的面试，十分类似于大学期末考试题。我曾经以为基础面试十分重要，但是现在不这么看了。在工作中基础的确是重要的，但是在面试过程中，它必须具有区分性才有意义，也就是说P(工作好|基础好)的概率要高，那么考察指针使用，进程线程区别这样的基础题目才有它的意义。我的实际经验是，基础面试并不具有很好的区分性，和算法一样， 差不多P(工作好|基础好) = 50% 。同时，基础面试是最容易准备的，中国人有长期的应试教育经验，要准备几个把玩指针题目太容易了。 我曾经遇到过这样的面试者，他的C语言基础和编译、链接等原理掌握得非常好，给我留下了深刻的印象，我给的面试结论是：知识面不宽，只会C语言，但基础很扎实，建议录用。后来的事情证明了那个结论的前半部分是对的，但是”建议录用“错了。他在实际工作中表现得一塌糊涂，不理解需求，不理解整体架构;同时，上班时间不是花在项目上，而是花在阅读诸如《程序员的自我修养》之类的书籍上。最后，这位同事由于长期“不出活”离开了公司。 基础不是不重要，而是“基础好”不足以说明面试者能干好工作，因为基础是属于局部性知识，而实际工作需要综合性能力 ，二者有天壤之别。C语言、操作系统能考高分，但是不会写程序的人在大学我们还见得少吗? 软件开发就像盖房子，综合能力是设计和搭骨架，基础知识是码砖。张小龙原先Foxmail是Delphi开发的，他它不懂C#，你如果要招聘一个开发.NET Email客户端的人，你考察他对CLR掌握得好不好有意义吗? 让张小龙来开发一个C#版的Foxmail真的会有困难吗? 你招一个精通C#但没有Email客户端开发经验的人来真的比张小龙靠谱吗? 我说基础知识不重要，和古人说的“不积洼步无以至千里”是不是矛盾呢?不矛盾!“洼步”与“千里”是一种可累加关系，但再多的“基础知识”都累加不成“综合能力”。学习软件开发要像持续集成一样，一开始就是一个完整的系统，虽然规模不大，问题很多，但它麻雀虽小五脏俱全，从小系统到大系统，从简单系统到复杂系统逐步演化。 所以，基础好本身不足以说明太多的问题，必须进一步考察综合能力。对于基础面试表现不好的面试者，如果时间允许也要进一步考察，有的面试者其实是有能力的，只是没有进行充分的准备。最理想的状态当然是基础和综合能力俱佳，若不能兼顾，应当综合能力优先。 <strong>经验</strong> 这里所说的经验不是通过工作了多少年来衡量的，而主要是指面试者的经历，比如，是否完整地实现过一个软件，或作为主要开发者完成过一个项目。经验的重要性在于它能说明一个人的综合能力 。从项目的性质、规模和难度，面试官就可以大致判断出面试者的综合能力。如果一个面试者一直在大公司负责一个小模块的开发维护，那么基本可以判断他不具备独立或作为主要开发者承担一个项目的能力，只适合在另一家大公司做类似的事情。对于门槛较高需要长期技术积累的职位，相关经验更显得尤为重要，比如，Linux内核开发，JVM开发，游戏引擎开发，数据库实现，高级UX等。对于这类职位，没有经验的面试者即使综合素质不错也是需要长时间的学习和积累才能胜任。所以，基本上如果确定了你的职位属于此类，那么相关经验毫无疑问应该成为首选因素，换句话说，P(工作好 | 相关经验好)的概率是非常高的。 通过项目经验判断面试者的优劣比通过基础和算法测试更加靠谱，所以，面试过程中面试官应该花比较多的时间听面试者介绍项目经验，并进行深入地探讨交流，了解面试者的知识面、思维能力、表达能力等。同时，可以结合项目提一些基础知识和算法的问题，比如，如果面试者做过C++相关的项目，那就可以问他如何进行内存管理?是否熟悉智能指针?如果面试者的回答不能令人满意，那么就基本上可以判断他的项目做得不是很好。 要注意的是，经验也是一个多维度的事物。比如，C++股票交易中间件系统，这就涉及(C++，中间件，股票) 3个维度。假如面试者A做过C++股票交易客户端，面试者B做过C的股票交易中间件。从语言角度看，A最匹配，从项目性质看，B最匹配，你如何选择?这就是在多个维度中，哪个维度更重要的问题，就这个例子而言，我个人更倾向于B，因为我认为中间件开发经验是主要矛盾，而从C切换到C++并不是问题。所以，面试官需要判断哪一种经验是主要的，而哪一种经验是次要的。比如，我们招聘Android应用开发，这个职位的Android技术门槛并不高，它的真正难点在于做出好的用户体验。所以，如果一个面试者没有iOS的经验我们是可以接受的，但是我希望他在UX方面有经验，至少做过其他平台的移动应用开发。 <strong>性格</strong> 现在，我来谈我认为最重要的因素：性格 。这可能是许多初为面试官的朋友所难以想象的，怎么会是性格最重要呢?说实话，当我意识到这一点时，我自己也很惊讶!说白了，还是 P(工作好|性格好)的概率最高啊。我的实际经验是，如果一个人的性格好，他能把工作做好的可能性是最高的，性格好远比基础好、算法好要靠谱。 一个人如果技术上有缺陷，经验上有不足，但性格好，在团队中是很容易由其他人来补位的，他自己也很容易逐渐补起来;相反，如果一个人的性格不好，所有的技术优势经验优势都发挥不出来，甚至还会起到负作用，而且性格缺点很难改变。我一直谈到实际工作所需要的是综合性的能力，这种综合能力的发挥中性格是至关重要的。项目中不止会遇到技术问题，要涉及沟通、协调，不同的人不同的部门既有合作又有磨擦，如何处理这些事情都需要一个良好的性格。可以说，在开发团队里让你与众不同的不是你从哪个学校毕业，也不是你过去的经验，而是你的性格。 当然，性格是一个复杂的东西，它包含了很多的方面，并非所有方面都是程序员面试所需要关注的。我的经验是可以重点考察这些方面： 1) 态度积极还是消极。有的面试者在谈吐中就会自然给你一种积极上进的感觉，或者你可以在他的经历中发现他积极的因素，这些都不是太难看出来的。相反，有的面试者你能明显感觉到他的消极情绪。积极性在工作中是十分重要的，积极的人能给团队带来朝气，也更易于合作。基本上，如果确定面试者属于态度积极的，他通过我这一关的可能性就会大大增加;相反，如果确定属于态度消极的，即使技术能力不错我也会十分谨慎。 2) IQ。我的经验是，总体来看，聪明的人在工作中的表现更为优秀。在面试中要考察一个人是否聪明并不一定要像Google和MS那样找些专门测试IQ的智力题，其实，你只需要看他讨论问题是不是很有逻辑性，思考和说话是不是反应敏捷就可以做出大致的判断。另外，眼睛是人心灵的窗户，一个人聪明与否，眼睛是会说话的。不过，聪明也不完全是优点，比如，当公司或项目遇到困难时，往往是聪明人先跑掉了，坚守的往往是IQ一般的人。 3) 语言表达能力。语言表达能力也是程序员十分重要的一项素质，它关系到项目中的沟通是否顺畅。面试官可以看看面试者能否用简明的语言介绍清楚曾经做过的项目，能否抓住要点，能否考虑到听者的相关背景。一般来讲，语言表达能力强的人综合能力都不会太差。 4) 是否具有用户意识。有人说程序员是做研发的，哪来什么用户?只有销售、市场人员才会和用户打交道。其实，这是完完全全的错误认识。你写一个模块，甚至一个API，只要有别人用，他就是你的用户。有的程序员设计一个模块或是一个软件总是习惯于从使用者的角度来考虑，尽量地方便使用者，这就是一种良好的用户意识。具有良好的用户意识的人更能考虑别人的感受和整体的需要，而不是单纯地从自己和局部来思考问题。当面试者谈及过去的项目经验时，面试官可以常常站在用户的角度对其进行提问，从这个过程中观察其是否具有良好的用户意识。 5) 如何应对质疑和压力。面试官应该对面试者的回答以及以往项目进行合理的质疑，看看他如何应对。曾经有一位面试者谈到做游戏登录服务器的经历，我就问：“如果登录服务器挂了，怎么办呢”?他说原先虽然没有考虑这个问题，但是可以怎么怎么改进。其实，大家都理解项目中有各种不完美，这里面原因]很多，只要面对质疑和压力能从容应对努力往好的方向思考解决就可以了，不需要掩饰缺陷，更不应该有情绪。我遇到过有的面试者，一旦你对其项目提出质疑，他马上产生反抗情绪，或不高兴，或不承认有问题，这很容易一下子看出来他在工作中容不得质疑和批评，这种人要想合作就很困难。 6) 个性特点。许多面试者喜欢在简历上写“精通C++/Linux“，这些字眼看得人麻木，如果有人写”喜欢C++/Linux“，我就会有一种眼前一亮的感觉。“精通”是没有感情色彩的叙述，而“喜欢”包含了面试者的个性，我更愿意看到面试者的个性。我相信对某样东西真正的热情远比你当前对它的掌握程度更为重要。其实，N年的经历告诉我们，同一个班的同学，同一个项目组的同事，虽然每天所学的知识，所接触的工作都是相同的，但其实每个人的成绩和表现差异是十分明显的。那么，到底本质的差异是什么呢?其实，就是每个人的个性。是个性使得有的人业余时间去打球，有的人业余时间去看书，有的人喜欢Linux，有的人喜欢Mac。一个人在团队中扮演的角色也和他的个性有很大的关系。面试官应该引导面试者展现自己的个性，并判断其是否有益于团队。 <strong>总结</strong> 最后总结起来，我的经验是： 1) 面试官的目标是找到”工作好“的人，一定要围绕这个目标来进行面试，如果把面试当成了算法或操作系统期末考试这就走入了误区;2) 面试过程是通过学历、性格、基础、经验、算法等可以测试的因素去综合判断面试者“工作好”的概率;3) 在各种因素中，性格 &gt; 经验 &gt; 基础 &gt; 算法。性格是最重要的，如果性格不好，所有技术能力都会大打折扣，而且技术缺陷容易弥补，性格缺陷很难改变;经验体现了一个人的综合能力，你可以从面试者过去的经历中判断他能从事哪种工作，不能从事哪种工作;基础和算法则主要起到辅助参考的作用，基础好的程序员一般适应性比较强，学新技术更快，但是切忌单纯从基础来判断一个人的能力。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/progammer/" data-id="cjvp22zz4000psomhfo9rdd33" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/progammer/">progammer</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-actionscope" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/actionscope/">python作用域</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/actionscope/" class="article-date">
  <time datetime="2018-10-30T07:53:01.000Z" itemprop="datePublished">2018-10-30</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/10/timg-300x161.jpeg" alt=""> 都说人生苦短，Python当歌。最近得空研究下Python，作为一个面向对象动态脚本语言，其功能强大语法简单易读还是蛮厉害的。 Python的执行机制也是类似于Java，.NET一样首先编译成byte code最后由Python Virtual Machine来进行执行。 初学的时候发现Python的变量作用域机制跟C#有很大不同，表达式可以正常访问全局/局部命名空间里的变量。重点是全局变量和局部变量重名，则局部变量会覆盖全局变量=。= 方法都会由自己的命名空间。类的方法的作用域规则和通常方法的一样。 Python会去猜测一个变量是局部的还是全局的，默认任何在方法内赋值的变量都是局部变量。不会对全局变量进行赋值变更操作。 因此如果需要在方法内对全局变量进行赋值操作并且生效的话，需要在赋值前对变量进行全局标示：global VarName</p>
<ol>
<li><p>testNumber = 0  </p>
</li>
<li><p>defsum(num,num1):  </p>
</li>
<li><p>global testNumber  </p>
</li>
<li><p>testNumber = num + num1  </p>
</li>
<li><p>print ‘function testNumber {0}’.format(testNumber)  </p>
</li>
<li><p>return testNumber  </p>
</li>
<li><p>print ‘Init testNumber {0}’.format(testNumber)  </p>
</li>
<li><p>sum(1,1)  </p>
</li>
<li><p>print ‘Added testNumber {0}’.format(testNumber)  </p>
</li>
</ol>
<p><img src="https://iuu.me/wp-content/uploads/2018/10/1540885881533-1024x365.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/actionscope/" data-id="cjvp22zyj0002somhxfqra0by" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/action-scope/">action scope</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-servicesdependedon" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/servicesdependedon/">Windows服务依赖关系</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/servicesdependedon/" class="article-date">
  <time datetime="2018-10-23T07:54:09.000Z" itemprop="datePublished">2018-10-23</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/10/1540281144714-300x176.jpg" alt=""> 适用于windows服务需要处理下游数据依赖于其他的上游服务生产。 ProjectInstaller的Install方法里面有一个ServiceInstaller.ServicesDependedOn 属性 设置windows服务的依赖关系。</p>
<ol>
<li><p>using System;  </p>
</li>
<li><p>using System.Collections;  </p>
</li>
<li><p>using System.Collections.Generic;  </p>
</li>
<li><p>using System.ComponentModel;  </p>
</li>
<li><p>using System.Configuration.Install;  </p>
</li>
<li><p>using System.Linq;  </p>
</li>
<li><p>namespace MQSupportService  </p>
</li>
<li><p>{  </p>
</li>
<li><p>[RunInstaller(true)]  </p>
</li>
<li><p>public partial class ProjectInstaller : System.Configuration.Install.Installer  </p>
</li>
<li><p>{  </p>
</li>
<li><p>public ProjectInstaller()  </p>
</li>
<li><p>{  </p>
</li>
<li><p>InitializeComponent();  </p>
</li>
<li><p>//依赖服务注册</p>
</li>
<li><p>serviceInstaller1.ServicesDependedOn = newstring[] { “MSMQ” };  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/servicesdependedon/" data-id="cjvp22zz5000tsomh8r4yszll" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csharp/">csharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows-service/">windows service</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-lesuploaddatetosap" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/lesuploaddatetosap/">LES上传业务交易数据至SAP</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/lesuploaddatetosap/" class="article-date">
  <time datetime="2018-07-25T10:51:11.000Z" itemprop="datePublished">2018-07-25</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/07/backup-300x300.jpg" alt=""> 修改项目业务域代码备份 Win service:</p>
<ol>
<li><p>using CC.Utility.DataTrans;  </p>
</li>
<li><p>using LES.DAL.IFMManagement;  </p>
</li>
<li><p>using LES.DAL.LogManagement;  </p>
</li>
<li><p>using LES.DM.IFMDataModel;  </p>
</li>
<li><p>using Microsoft.LES.JinKang.Interface.ESB.Schema;  </p>
</li>
<li><p>using System;  </p>
</li>
<li><p>using System.Collections.Generic;  </p>
</li>
<li><p>using System.Configuration;  </p>
</li>
<li><p>using System.Linq;  </p>
</li>
<li><p>using System.Text;  </p>
</li>
<li><p>using System.Windows.Forms;  </p>
</li>
<li><p>using WinServiceTest.ServiceReference1;  </p>
</li>
<li><p>using WinServiceTest.Utils;  </p>
</li>
<li><p>namespace WinServiceTest.Services  </p>
</li>
<li><p>{  </p>
</li>
<li><p>publicclass TranslogTosapServices : BasicService  </p>
</li>
<li><p>{  </p>
</li>
<li><p>private TranslogTosapDAL dao = new TranslogTosapDAL();  </p>
</li>
<li><p>publicvoid Services(TextBox tbox)  </p>
</li>
<li><p>{  </p>
</li>
<li><p>ShowMessage(tbox, $”正在加载库存交易数据…”);  </p>
</li>
<li><p>var initData = GetInfoList();  </p>
</li>
<li><p>if (initData.Count &gt; 0)  </p>
</li>
<li><p>{  </p>
</li>
<li><p>ShowMessage(tbox, $”当前LES库存交易数据共有[{initData.Count}]条。”);  </p>
</li>
<li><p>var xml = SetData(initData);  </p>
</li>
<li><p>ShowMessage(tbox, $”库存交易数据XML生产完毕。”);  </p>
</li>
<li><p>CacheHelper.GetOrAddCacheItem(“TTS_XML”, () =&gt; { return xml; }, null);  </p>
</li>
<li><p>ShowMessage(tbox, “XML缓存完毕。”);  </p>
</li>
<li><p>ShowMessage(tbox, “正在尝试提交至ESB…”);  </p>
</li>
<li><p>var client = new BizTransUpload_pttClient();  </p>
</li>
<li><p>var result = client.BizTransUpload(new ServiceReference1.SoaHeader  </p>
</li>
<li><p>{  </p>
</li>
<li><p>TxnID = Guid.NewGuid().ToString(),  </p>
</li>
<li><p>TimeStamp = DateTime.Now.ToString(“yyyy-MM-dd HH:mm:ss.fff”)  </p>
</li>
<li><p>}, xml);  </p>
</li>
<li><p>ShowMessage(tbox, $”ESB RETURN-&gt;[{result.STATUS}]::{result.MESSAGE}。”);  </p>
</li>
<li><p>var redata = result.MESSAGE.ToObject<biztransuploadfeedbackcollection>();  </biztransuploadfeedbackcollection></p>
</li>
<li><p>redata.BizTrans.ToList().ForEach((BizTransType data) =&gt;   </p>
</li>
<li><p>{  </p>
</li>
<li><p>// update status</p>
</li>
<li><p>var returnData = new SAPReturnData  </p>
</li>
<li><p>{  </p>
</li>
<li><p>Id = data.ID,  </p>
</li>
<li><p>State = data.STATUS,  </p>
</li>
<li><p>MessAge = data.MESSAGE  </p>
</li>
<li><p>};                   </p>
</li>
<li><p>dao.UpDataState7DTC(returnData, returnData.State.ToUpper() != “S” ? 3 : 1);  </p>
</li>
<li><p>// update interface log</p>
</li>
<li><p>var _log = new SapInterfaceLogDAL();  </p>
</li>
<li><p>var logInfo = new SapInterfaceLogInfo  </p>
</li>
<li><p>{  </p>
</li>
<li><p>ResponseTime = DateTime.Now,  </p>
</li>
<li><p>DealFlag = data.STATUS.ToUpper() == “S” ? 1 : 9,  </p>
</li>
<li><p>ReturnMessage = data.MESSAGE,  </p>
</li>
<li><p>ErrorMessage = data.MESSAGE,  </p>
</li>
<li><p>ModifiedTime = DateTime.Now  </p>
</li>
<li><p>};  </p>
</li>
<li><p>_log.Update(logInfo);  </p>
</li>
<li><p>});  </p>
</li>
<li><p>Log(xml);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>else</p>
</li>
<li><p>{  </p>
</li>
<li><p>ShowMessage(tbox, $”当前没有库存交易数据,服务已停止。”);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li><p>//LesToSap Loginfo</p>
</li>
<li><p>privatevoid Log(string xml)  </p>
</li>
<li><p>{  </p>
</li>
<li><p>var _les2sap = new LesSapRequestDAL();  </p>
</li>
<li><p>_les2sap.Add(new LES.DM.LogLES2SAPDataModel.LesSapRequestInfo  </p>
</li>
<li><p>{  </p>
</li>
<li><p>Biztransactionid = Guid.NewGuid().ToString(),  </p>
</li>
<li><p>Interfacecode = “ISAP005”,  </p>
</li>
<li><p>Interfaceinfo = “LES库存交易上传SAP(包括自材料入库、移库、领用等)”,  </p>
</li>
<li><p>Transactionid = Guid.NewGuid(),  </p>
</li>
<li><p>Xmldata = xml,  </p>
</li>
<li><p>Createdtime = DateTime.Now  </p>
</li>
<li><p>});  </p>
</li>
<li><p>}  </p>
</li>
<li><p>/// <summary></summary></p>
</li>
<li><p>/// 发送数据</p>
</li>
<li><p>/// </p>
</li>
<li><p>/// <param name="dest"></p>
</li>
<li><p>/// <param name="Name"></p>
</li>
<li><p>/// <param name="TableName"></p>
</li>
<li><p>/// <param name="ParName"></p>
</li>
<li><p>/// <param name="Data"></p>
</li>
<li><p>/// <param name="List"></p>
</li>
<li><p>privatestring SetData(List<translogtosapinfo> List)  </translogtosapinfo></p>
</li>
<li><p>{  </p>
</li>
<li><p>var BTUR = new List<biztransuploadtype>();  </biztransuploadtype></p>
</li>
<li><p>var result = new BizTransUploadCollection();  </p>
</li>
<li><p>List = List.OrderBy(v =&gt; v.ItemNo).ToList();  </p>
</li>
<li><p>foreach (var item in List)  </p>
</li>
<li><p>{  </p>
</li>
<li><p>BTUR.Add(new BizTransUploadType  </p>
</li>
<li><p>{  </p>
</li>
<li><p>SEQ_ID = item.Seq,  </p>
</li>
<li><p>BATCH_NO = item.BatchNo,  </p>
</li>
<li><p>WMTRAN_NO = item.WmtranNo,  </p>
</li>
<li><p>LES_YEAR = item.LesYear,  </p>
</li>
<li><p>LES_DOC = item.LesDoc,  </p>
</li>
<li><p>//DOC_DATE = item.DocDate.Value.ToString(“yyyymmdd”),</p>
</li>
<li><p>DOC_DATE = item.DocDate.Value.ToString(“yyyy-MM-dd”, System.Globalization.DateTimeFormatInfo.InvariantInfo),  </p>
</li>
<li><p>PLANT = item.Plant,  </p>
</li>
<li><p>STGE_LOC = item.StgeLoc,  </p>
</li>
<li><p>//MOVE_PLANT = item.MovePlant,</p>
</li>
<li><p>MOVE_STLOC = item.MoveStloc,  </p>
</li>
<li><p>VENDOR = item.Vendor,  </p>
</li>
<li><p>MATERIAL = item.Material,  </p>
</li>
<li><p>ENTRY_QNT = item.EntryQnt.ToString(),  </p>
</li>
<li><p>MOVE_TYPE = item.WmtranNo,  </p>
</li>
<li><p>COSTCENTER = item.Costcenter,  </p>
</li>
<li><p>AUFNR = item.Aufnr,  </p>
</li>
<li><p>MOVE_VEN = item.MoveVen,  </p>
</li>
<li><p>//ORDNO = item.OrderNo,</p>
</li>
<li><p>ORDNO = “”,  </p>
</li>
<li><p>//PSTNG_DATE = item.PstngDate?.ToString(“yyyymmdd”),</p>
</li>
<li><p>PSTNG_DATE = item.PstngDate?.ToString(“yyyy-MM-dd”, System.Globalization.DateTimeFormatInfo.InvariantInfo),  </p>
</li>
<li><p>OPERATION = item.Operation,  </p>
</li>
<li><p>AUART = item.Auart,  </p>
</li>
<li><p>PO_NUMBER = item.OrderNo,  </p>
</li>
<li><p>LES_ITEM = item.ItemNo,  </p>
</li>
<li><p>PO_ITEM = item.ItemNo  </p>
</li>
<li><p>});  </p>
</li>
<li><p>}  </p>
</li>
<li><p>result.BizTrans = BTUR.ToArray();  </p>
</li>
<li><p>return result.ToXml();  </p>
</li>
<li><p>}  </p>
</li>
<li><p>private List<translogtosapinfo> GetInfoList()  </translogtosapinfo></p>
</li>
<li><p>{  </p>
</li>
<li><p>dao.InitTable();  </p>
</li>
<li><p>return dao.GetInfoList();  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
</ol>
<p>PROC_LESTOSAP_TRANSLOG:</p>
<ol>
<li><p>ALTER proc [LES].[PROC_LESTOSAP_TRANSLOG]  </p>
</li>
<li><p>AS</p>
</li>
<li><p>BEGIN</p>
</li>
<li><p>BEGIN   TRY   </p>
</li>
<li><p>DECLARE @Tran VARCHAR(100);–移动类型</p>
</li>
<li><p>DECLARE @CHANGETran VARCHAR(100)–组合零件移动类型</p>
</li>
<li><p>DECLARE @TRAN_NO VARCHAR(100)  </p>
</li>
<li><p>BEGINTRANSACTION</p>
</li>
<li><p>TRUNCATETABLE LES.TG_WMM_SAP_TRAN_DETAIL_LOG  </p>
</li>
<li><p>–获取成品半成品入库移动类型</p>
</li>
<li><p>SELECTTOP 1  @TRAN_NO=PARAMETER1   </p>
</li>
<li><p>FROM  LES.TM_SYS_APPLICATION_CONFIGURATION   </p>
</li>
<li><p>WHERE  APPLICATION=’TranGoodTRan’  </p>
</li>
<li><p>–入库信息插入</p>
</li>
<li><p>INSERTINTO  les.TG_WMM_SAP_TRAN_DETAIL_LOG  </p>
</li>
<li><p>(  </p>
</li>
<li><p>RUNSHEET_SN,  </p>
</li>
<li><p>RUNSHEET_NO,  </p>
</li>
<li><p>TRAN_SHEET_ID,  </p>
</li>
<li><p>TRAN_TIME,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>TARGET_ZONE,  </p>
</li>
<li><p>PO_SUPPLIER_NUM,  </p>
</li>
<li><p>PART_NO,  </p>
</li>
<li><p>NUM,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>PART_TYPE,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>HU_BARCODE_DATA,  </p>
</li>
<li><p>BATCH_NO  </p>
</li>
<li><p>)  </p>
</li>
<li><p>SELECT</p>
</li>
<li><p>A.RECEIVE_ID,  </p>
</li>
<li><p>RECEIVE_NO,  </p>
</li>
<li><p>A.RECEIVE_ID,  </p>
</li>
<li><p>ISNULL(A.TRAN_TIME,GETDATE()),  </p>
</li>
<li><p>A.PLANT,  </p>
</li>
<li><p>A.TRAN_NO,  </p>
</li>
<li><p>B.TARGET_ZONE,  </p>
</li>
<li><p>B.PO_SUPPLIER_NUM,  </p>
</li>
<li><p>B.PART_NO,  </p>
</li>
<li><p>B.ACTUAL_QTY,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>B.PART_TYPE,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>B.BARCODE_DATA,  </p>
</li>
<li><p>B.HU_ID,  </p>
</li>
<li><p>B.BATCH_NO  </p>
</li>
<li><p>FROM  LES.TT_WMM_RECEIVE_CONFIRM as A,  </p>
</li>
<li><p>LES.TT_WMM_RECEIVE_DETAIL_CONFIRM as B  </p>
</li>
<li><p>WHEREISNULL(A.ERP_FLAG,0)=0   </p>
</li>
<li><p>AND  CONFIRM_FLAG=2   </p>
</li>
<li><p>AND  A.RECEIVE_ID=B.RECEIVE_ID  </p>
</li>
<li><p>AND  A.TRAN_NO ISNOTNULL</p>
</li>
<li><p>ANDisnull(B.ACTUAL_QTY,0)&lt;&gt;0  </p>
</li>
<li><p>AND  B.PART_NO NOTIN (SELECT  PART_NO FROM  LES.TM_BAS_COMBINE_PARTS GROUPBY  PART_NO)–不是组合零件</p>
</li>
<li><p>AND A.TRAN_NO NOTIN(select item from Split(@TRAN_NO,’,’))  </p>
</li>
<li><p>–AND NOT EXISTS (SELECT 1 FROM LES.TM_BAS_COMBINE_PARTS WHERE PART_NO=B.PART_NO)</p>
</li>
<li><p>–更新入库表状态</p>
</li>
<li><p>UPDATE  A  </p>
</li>
<li><p>SET  ERP_FLAG=1  </p>
</li>
<li><p>FROM  LES.TT_WMM_RECEIVE_CONFIRM AS A INNERJOIN LES.TG_WMM_SAP_TRAN_DETAIL_LOG AS B  </p>
</li>
<li><p>ON A.RECEIVE_NO=B.RUNSHEET_NO  </p>
</li>
<li><p>WHEREISNULL(ERP_FLAG,0)=0 AND  CONFIRM_FLAG=2   </p>
</li>
<li><p>INSERTINTO  les.TG_WMM_SAP_TRAN_DETAIL_LOG  </p>
</li>
<li><p>(  </p>
</li>
<li><p>RUNSHEET_SN,  </p>
</li>
<li><p>RUNSHEET_NO,  </p>
</li>
<li><p>TRAN_SHEET_ID,  </p>
</li>
<li><p>TRAN_TIME,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>TARGET_ZONE,  </p>
</li>
<li><p>PO_SUPPLIER_NUM,  </p>
</li>
<li><p>PART_NO,  </p>
</li>
<li><p>NUM,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>PART_TYPE,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>BATCH_NO  </p>
</li>
<li><p>)  </p>
</li>
<li><p>SELECT</p>
</li>
<li><p>A.RECEIVE_ID,  </p>
</li>
<li><p>RECEIVE_NO,  </p>
</li>
<li><p>A.RECEIVE_ID,  </p>
</li>
<li><p>ISNULL(A.TRAN_TIME,GETDATE()),  </p>
</li>
<li><p>A.PLANT,  </p>
</li>
<li><p>A.TRAN_NO,  </p>
</li>
<li><p>B.TARGET_ZONE,  </p>
</li>
<li><p>B.PO_SUPPLIER_NUM,  </p>
</li>
<li><p>B.PART_NO,  </p>
</li>
<li><p>SUM(B.ACTUAL_QTY),  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>B.PART_TYPE,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>B.BARCODE_DATA,  </p>
</li>
<li><p>B.BATCH_NO  </p>
</li>
<li><p>FROM  LES.TT_WMM_RECEIVE_CONFIRM as A,  </p>
</li>
<li><p>LES.TT_WMM_RECEIVE_DETAIL_CONFIRM as B  </p>
</li>
<li><p>WHEREISNULL(A.ERP_FLAG,0)=0   </p>
</li>
<li><p>AND  CONFIRM_FLAG=2   </p>
</li>
<li><p>AND  A.RECEIVE_ID=B.RECEIVE_ID  </p>
</li>
<li><p>AND  A.TRAN_NO ISNOTNULL</p>
</li>
<li><p>ANDisnull(B.ACTUAL_QTY,0)&lt;&gt;0  </p>
</li>
<li><p>AND  B.PART_NO NOTIN (SELECT  PART_NO FROM  LES.TM_BAS_COMBINE_PARTS GROUPBY  PART_NO)–不是组合零件</p>
</li>
<li><p>AND A.TRAN_NO IN(select item from Split(@TRAN_NO,’,’))  </p>
</li>
<li><p>GROUPBY A.RECEIVE_ID,RECEIVE_NO,A.RECEIVE_ID,ISNULL(A.TRAN_TIME,GETDATE()),A.PLANT,A.TRAN_NO,  </p>
</li>
<li><p>B.TARGET_ZONE,B.PO_SUPPLIER_NUM,B.PART_NO,COST_CODE,INTERNAL_CODE,B.PART_TYPE,ORDER_NO,ITEM_NO,IDOC,  </p>
</li>
<li><p>B.BARCODE_DATA,B.BATCH_NO  </p>
</li>
<li><p>UPDATE  A  </p>
</li>
<li><p>SET  ERP_FLAG=1  </p>
</li>
<li><p>FROM  LES.TT_WMM_RECEIVE_CONFIRM AS A INNERJOIN LES.TG_WMM_SAP_TRAN_DETAIL_LOG AS B  </p>
</li>
<li><p>ON A.RECEIVE_NO=B.RUNSHEET_NO  </p>
</li>
<li><p>WHEREISNULL(ERP_FLAG,0)=0 AND  CONFIRM_FLAG=2   </p>
</li>
<li><p>–出库信息插入</p>
</li>
<li><p>INSERTINTO  LES.TG_WMM_SAP_TRAN_DETAIL_LOG  </p>
</li>
<li><p>(  </p>
</li>
<li><p>RUNSHEET_SN,  </p>
</li>
<li><p>RUNSHEET_NO,  </p>
</li>
<li><p>TRAN_SHEET_ID,  </p>
</li>
<li><p>TRAN_TIME,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>TARGET_ZONE,  </p>
</li>
<li><p>PO_SUPPLIER_NUM,  </p>
</li>
<li><p>PART_NO,  </p>
</li>
<li><p>NUM,  </p>
</li>
<li><p>PART_TYPE,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>RELATED_SUPPLIER_NUM,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>HU_BARCODE_DATA,  </p>
</li>
<li><p>BATCH_NO  </p>
</li>
<li><p>)  </p>
</li>
<li><p>SELECT</p>
</li>
<li><p>A.OUTPUT_ID,  </p>
</li>
<li><p>OUTPUT_NO,  </p>
</li>
<li><p>A.OUTPUT_ID,  </p>
</li>
<li><p>A.TRAN_TIME,  </p>
</li>
<li><p>A.PLANT,  </p>
</li>
<li><p>A.TRAN_NO,  </p>
</li>
<li><p>B.TARGET_ZONE,  </p>
</li>
<li><p>B.PO_SUPPLIER_NUM,  </p>
</li>
<li><p>B.PART_NO,  </p>
</li>
<li><p>B.ACTUAL_QTY,  </p>
</li>
<li><p>B.PART_TYPE,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>RES_SUPPLIER_NUM,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>B.BARCODE_DATA,  </p>
</li>
<li><p>B.HU_ID,  </p>
</li>
<li><p>B.BATCH_NO  </p>
</li>
<li><p>FROM   LES.TT_WMM_OUTPUT_CONFIRM as A,  </p>
</li>
<li><p>LES.TT_WMM_OUTPUT_DETAIL_CONFIRM as B  </p>
</li>
<li><p>WHEREISNULL(A.ERP_FLAG,0)=0 AND  CONFIRM_FLAG=2 AND  A.OUTPUT_ID=B.OUTPUT_ID  </p>
</li>
<li><p>ANDisnull(B.ACTUAL_QTY,0)&lt;&gt;0  </p>
</li>
<li><p>AND  A.TRAN_NO ISNOTNULL</p>
</li>
<li><p>AND A.TRAN_NO NOTIN(SELECT TRAN_NO FROM LES.TM_WMM_TRANTYPE WHERE SHEET_TYPE IN(19,20,21,29) ANDISNULL(TRAN_NO,’’)&lt;&gt;’’)  </p>
</li>
<li><p>AND  B.PART_NO NOTIN (SELECT  PART_NO FROM  LES.TM_BAS_COMBINE_PARTS GROUPBY  PART_NO)  </p>
</li>
<li><p>–AND NOT EXISTS (SELECT 1 FROM LES.TM_BAS_COMBINE_PARTS WHERE PART_NO=B.PART_NO)</p>
</li>
<li><p>–出库信息插入 移动类型-单据类型(19,20,21,29)取值发货单‘源存储区’和‘目标存储区’ 库存地点转化取值‘存储区维护’的IM对应区</p>
</li>
<li><p>INSERTINTO  LES.TG_WMM_SAP_TRAN_DETAIL_LOG  </p>
</li>
<li><p>(  </p>
</li>
<li><p>RUNSHEET_SN,  </p>
</li>
<li><p>RUNSHEET_NO,  </p>
</li>
<li><p>TRAN_SHEET_ID,  </p>
</li>
<li><p>TRAN_TIME,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>–TARGET_ZONE,</p>
</li>
<li><p>PO_SUPPLIER_NUM,  </p>
</li>
<li><p>PART_NO,  </p>
</li>
<li><p>NUM,  </p>
</li>
<li><p>PART_TYPE,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>RELATED_SUPPLIER_NUM,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>HU_BARCODE_DATA,  </p>
</li>
<li><p>ZONE_NO,  </p>
</li>
<li><p>TARGET_ZONE,  </p>
</li>
<li><p>BATCH_NO  </p>
</li>
<li><p>)  </p>
</li>
<li><p>SELECT</p>
</li>
<li><p>A.OUTPUT_ID,  </p>
</li>
<li><p>OUTPUT_NO,  </p>
</li>
<li><p>A.OUTPUT_ID,  </p>
</li>
<li><p>A.TRAN_TIME,  </p>
</li>
<li><p>A.PLANT,  </p>
</li>
<li><p>A.TRAN_NO,  </p>
</li>
<li><p>–B.TARGET_ZONE,</p>
</li>
<li><p>B.PO_SUPPLIER_NUM,  </p>
</li>
<li><p>B.PART_NO,  </p>
</li>
<li><p>B.ACTUAL_QTY,  </p>
</li>
<li><p>B.PART_TYPE,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>RES_SUPPLIER_NUM,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>B.BARCODE_DATA,  </p>
</li>
<li><p>B.HU_ID,  </p>
</li>
<li><p>C.IM_LOCATION,  </p>
</li>
<li><p>D.IM_LOCATION,  </p>
</li>
<li><p>B.BATCH_NO  </p>
</li>
<li><p>FROM   LES.TT_WMM_OUTPUT_CONFIRM as A,  </p>
</li>
<li><p>LES.TT_WMM_OUTPUT_DETAIL_CONFIRM as B  </p>
</li>
<li><p>JOIN LES.TM_WMM_ZONES C ONISNULL(B.ZONE_NO,’’)=C.ZONE_NO  </p>
</li>
<li><p>JOIN LES.TM_WMM_ZONES D ONISNULL(B.TARGET_ZONE,’’)=D.ZONE_NO  </p>
</li>
<li><p>WHEREISNULL(A.ERP_FLAG,0)=0 AND  CONFIRM_FLAG=2 AND  A.OUTPUT_ID=B.OUTPUT_ID  </p>
</li>
<li><p>ANDisnull(B.ACTUAL_QTY,0)&lt;&gt;0  </p>
</li>
<li><p>AND  A.TRAN_NO ISNOTNULL</p>
</li>
<li><p>AND A.TRAN_NO IN(SELECT TRAN_NO FROM LES.TM_WMM_TRANTYPE WHERE SHEET_TYPE IN(19,20,21,29) ANDISNULL(TRAN_NO,’’)&lt;&gt;’’)  </p>
</li>
<li><p>AND  B.PART_NO NOTIN (SELECT  PART_NO FROM  LES.TM_BAS_COMBINE_PARTS GROUPBY  PART_NO)  </p>
</li>
<li><p>–更新出库表状态</p>
</li>
<li><p>UPDATE  A  </p>
</li>
<li><p>SET  ERP_FLAG=1   </p>
</li>
<li><p>FROM  LES.TT_WMM_OUTPUT_CONFIRM AS A INNERJOIN LES.TG_WMM_SAP_TRAN_DETAIL_LOG AS B  </p>
</li>
<li><p>ON A.OUTPUT_NO=B.RUNSHEET_NO  </p>
</li>
<li><p>WHEREISNULL(ERP_FLAG,0)=0 and CONFIRM_FLAG=2  </p>
</li>
<li><p>–添加成本中心及内部订单</p>
</li>
<li><p>–update LES.TG_WMM_SAP_TRAN_DETAIL_LOG </p>
</li>
<li><p>–set COST_CODE=A.COST_CODE,</p>
</li>
<li><p>–INTERNAL_CODE=A.INTERNAL_CODE</p>
</li>
<li><p>–from LES.TT_WMM_TRAN_HEAD as A</p>
</li>
<li><p>–where RUNSHEET_NO=A.TRAN_SHEET_NO</p>
</li>
<li><p>–更新零件类型</p>
</li>
<li><p>–Update A</p>
</li>
<li><p>–SET PART_TYPE=ISNULL(p.PART_TYPE,0)</p>
</li>
<li><p>–FROM LES.TG_WMM_SAP_TRAN_DETAIL_LOG A</p>
</li>
<li><p>–  INNER JOIN LES.TT_SPM_SUPPLIER_PART_QUOTA p ON A.PLANT=p.PLANT AND A.PART_NO=p.PART_NO AND A.PO_SUPPLIER_NUM=p.SUPPLIER_NUM</p>
</li>
<li><p>–更新虚拟供应商   </p>
</li>
<li><p>UPDATE  B  </p>
</li>
<li><p>SET  PO_SUPPLIER_NUM=’’</p>
</li>
<li><p>FROM  LES.TM_BAS_SUPPLIER AS A INNERJOIN   LES.TG_WMM_SAP_TRAN_DETAIL_LOG as B on PO_SUPPLIER_NUM=A.SUPPLIER_NUM  </p>
</li>
<li><p>WHERE  SUPPLIER_TYPE&lt;&gt;1  </p>
</li>
<li><p>–插入到接口表</p>
</li>
<li><p>INSERTINTO  LES.TI_WMS_TRANSLOG_TOSAP  </p>
</li>
<li><p>(  </p>
</li>
<li><p>SEQ,  </p>
</li>
<li><p>BATCH_NO,  </p>
</li>
<li><p>WMTRAN_NO,  </p>
</li>
<li><p>LES_YEAR,  </p>
</li>
<li><p>DOC_DATE,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>VENDOR,  </p>
</li>
<li><p>MATERIAL,  </p>
</li>
<li><p>ENTRY_QNT,  </p>
</li>
<li><p>SPEC_STOCK,  </p>
</li>
<li><p>MOVE_TYPE,  </p>
</li>
<li><p>MOVE_VEN,  </p>
</li>
<li><p>COSTCENTER,  </p>
</li>
<li><p>AUFNR,  </p>
</li>
<li><p>LES_DOC,  </p>
</li>
<li><p>PROCESS_FLAG,  </p>
</li>
<li><p>CREATE_USER,  </p>
</li>
<li><p>CREATE_DATE,  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>ORDER_TYPE,  </p>
</li>
<li><p>MEINS,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>HU_BARCODE_DATA,  </p>
</li>
<li><p>STGE_LOC,  </p>
</li>
<li><p>MOVE_STLOC  </p>
</li>
<li><p>)  </p>
</li>
<li><p>SELECT</p>
</li>
<li><p>dbo.GetDataString()+CAST(TRAN_DETAIL_ID ASVARCHAR),  </p>
</li>
<li><p>BATCH_NO,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>DATEPART(yyyy,ISNULL(TRAN_TIME,GETDATE())),  </p>
</li>
<li><p>TRAN_TIME,  </p>
</li>
<li><p>PLANT,  </p>
</li>
<li><p>PO_SUPPLIER_NUM,  </p>
</li>
<li><p>PART_NO,  </p>
</li>
<li><p>NUM,  </p>
</li>
<li><p>PART_TYPE,  </p>
</li>
<li><p>TRAN_NO,  </p>
</li>
<li><p>RELATED_SUPPLIER_NUM,  </p>
</li>
<li><p>COST_CODE,  </p>
</li>
<li><p>INTERNAL_CODE,  </p>
</li>
<li><p>RUNSHEET_NO,  </p>
</li>
<li><p>0 AS PROCESS_FLAG,  </p>
</li>
<li><p>‘SAP’,  </p>
</li>
<li><p>GETDATE(),  </p>
</li>
<li><p>ORDER_NO,  </p>
</li>
<li><p>ITEM_NO,  </p>
</li>
<li><p>IDOC,  </p>
</li>
<li><p>‘1’ AS ORDER_TYPE,  </p>
</li>
<li><p>(SELECT (SELECT MEASURING_UNIT_NO FROM [LES].[TM_BAS_MEASURING_UNIT] WHERE MEASURING_UNIT = PART.PART_UNITS) FROM [LES].[TM_BAS_MAINTAIN_PARTS] AS PART  </p>
</li>
<li><p>WHERE PART_NO=A.PART_NO) MEINS,  </p>
</li>
<li><p>BARCODE_DATA,  </p>
</li>
<li><p>HU_BARCODE_DATA,  </p>
</li>
<li><p>A.ZONE_NO,  </p>
</li>
<li><p>A.TARGET_ZONE  </p>
</li>
<li><p>FROM  LES.TG_WMM_SAP_TRAN_DETAIL_LOG as A  </p>
</li>
<li><p>WHEREisnull((select IM_TRAN from les.TM_WMM_TRANTYPE where TM_WMM_TRANTYPE.TRAN_NO=A.TRAN_NO),’’)&lt;&gt;’’</p>
</li>
<li><p>–添加SAP移动类型，仓库，目的仓库</p>
</li>
<li><p>UPDATE  LES.TI_WMS_TRANSLOG_TOSAP   </p>
</li>
<li><p>SET  MOVE_STLOC=DLOC,STGE_LOC=S_DLOC,WMTRAN_NO=IM_TRAN   </p>
</li>
<li><p>FROM LES.TM_WMM_TRANTYPE  </p>
</li>
<li><p>WHERE  LES.TM_WMM_TRANTYPE.WM_TRAN=WMTRAN_NO andisnull(PROCESS_FLAG,0)=0  </p>
</li>
<li><p>ANDISNULL(WMTRAN_NO,’’) NOTIN(SELECT TRAN_NO FROM LES.TM_WMM_TRANTYPE WHERE SHEET_TYPE IN(19,20,21,29) ANDISNULL(TRAN_NO,’’)&lt;&gt;’’)  </p>
</li>
<li><p>UPDATE  LES.TI_WMS_TRANSLOG_TOSAP   </p>
</li>
<li><p>SET WMTRAN_NO=IM_TRAN   </p>
</li>
<li><p>FROM LES.TM_WMM_TRANTYPE  </p>
</li>
<li><p>WHERE  LES.TM_WMM_TRANTYPE.WM_TRAN=WMTRAN_NO andisnull(PROCESS_FLAG,0)=0  </p>
</li>
<li><p>ANDISNULL(WMTRAN_NO,’’) IN(SELECT TRAN_NO FROM LES.TM_WMM_TRANTYPE WHERE SHEET_TYPE IN(19,20,21,29) ANDISNULL(TRAN_NO,’’)&lt;&gt;’’)  </p>
</li>
<li><p>–根据应用配置管理’SAPCHANGESTGE_LOC’理参数一里面移动类型把特殊库存改成自有</p>
</li>
<li><p>SELECTTOP 1  @CHANGETran=PARAMETER1 FROM  LES.[TM_SYS_APPLICATION_CONFIGURATION]   </p>
</li>
<li><p>WHERE  [APPLICATION] = ‘SAPCHANGESTGE_LOC’  </p>
</li>
<li><p>UPDATE  LES.TI_WMS_TRANSLOG_TOSAP   </p>
</li>
<li><p>SET  SPEC_STOCK=0 from LES.TM_WMM_TRANTYPE  </p>
</li>
<li><p>WHERE LES.TM_WMM_TRANTYPE.WM_TRAN=WMTRAN_NO ANDISNULL(PROCESS_FLAG,0)=0   </p>
</li>
<li><p>AND MOVE_TYPE IN (SELECT item FROM  Split(@CHANGETran,’,’))  </p>
</li>
<li><p>—-获取成品半成品入库移动类型</p>
</li>
<li><p>–SELECT TOP 1  @Tran=PARAMETER1 </p>
</li>
<li><p>–FROM  LES.TM_SYS_APPLICATION_CONFIGURATION </p>
</li>
<li><p>–WHERE  APPLICATION=’TranGoodTRan’</p>
</li>
<li><p>–修改成品半成品入库类型</p>
</li>
<li><p>UPDATE LES.TI_WMS_TRANSLOG_TOSAP  </p>
</li>
<li><p>SET ORDER_TYPE=0  </p>
</li>
<li><p>WHERE PROCESS_FLAG=0 AND  MOVE_TYPE IN (select item from Split(@TRAN_NO,’,’))   </p>
</li>
<li><p>–添加反入库类型备注  拆解</p>
</li>
<li><p>UPDATE LES.TI_WMS_TRANSLOG_TOSAP  </p>
</li>
<li><p>SET COMMENTS=’拆解’  </p>
</li>
<li><p>WHERE ORDER_TYPE=0 AND  PROCESS_FLAG=0 AND</p>
</li>
<li><p>MOVE_TYPE=(SELECTTOP 1 PARAMETER2 from LES.TM_SYS_APPLICATION_CONFIGURATION where APPLICATION=’TranGoodTRan’)   </p>
</li>
<li><p>–添加反入库类型备注  冲销</p>
</li>
<li><p>UPDATE LES.TI_WMS_TRANSLOG_TOSAP  </p>
</li>
<li><p>SET COMMENTS=’冲销’  </p>
</li>
<li><p>WHERE ORDER_TYPE=0 AND  PROCESS_FLAG=0 AND</p>
</li>
<li><p>MOVE_TYPE=(SELECTTOP 1 PARAMETER3 FROM  LES.TM_SYS_APPLICATION_CONFIGURATION where APPLICATION=’TranGoodTRan’)   </p>
</li>
<li><p>COMMITTRANSACTION</p>
</li>
<li><p>END  TRY   </p>
</li>
<li><p>BEGIN  CATCH   </p>
</li>
<li><p>–出错，则返回执行不成功，回滚事务</p>
</li>
<li><p>ROLLBACKTRANSACTION</p>
</li>
<li><p>–记录错误信息</p>
</li>
<li><p>INSERTINTO  [LES].[TS_SYS_EXCEPTION] (time_stamp, [application], [METHOD], class,  exception_message, error_code)  </p>
</li>
<li><p>SELECT  GETDATE(),’INTERFACE’,’LES.PROC_LESTOSAP_TRANSLOG’,’Procedure’,error_message(),ERROR_LINE()  </p>
</li>
<li><p>END   CATCH  </p>
</li>
<li><p>END</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/lesuploaddatetosap/" data-id="cjvp22zz2000osomhz3tknna1" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BACKUP/">BACKUP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LES/">LES</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-pcspull" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/pcspull/">PCS拉动分析</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/pcspull/" class="article-date">
  <time datetime="2018-07-23T09:56:22.000Z" itemprop="datePublished">2018-07-23</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/07/timg-1-300x200.jpg" alt=""> 最近的LES项目关于核心业务域各种拉动方式如JIT,PCS,MES,TWD,MIN/MAX等理解与思考。 感觉跨行业域做开发是真的挺不容易的Σ( ° △ °|||)︴ 尤其是在没有任何参考文档及数据库字典的情况下阅读别人的代码，还好有专业人员来辅助学习汽车制造行业业务域知识。。。不然整个业务流程理解下来的话真的感觉凉凉寸步难行。 最后想再吐槽一下这个深坑的项目代码。 <img src="https://iuu.me/wp-content/uploads/2018/07/PCS%E6%8B%89%E5%8A%A8.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/pcspull/" data-id="cjvp22zz0000jsomhzbhslyv0" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LES/">LES</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PCS/">PCS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PULL/">PULL</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-aud-azuresearch-indexer-document" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/aud-azuresearch-indexer-document/">Add/Update/Delete AzureSearch Indexer Document</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/aud-azuresearch-indexer-document/" class="article-date">
  <time datetime="2018-03-21T12:59:28.000Z" itemprop="datePublished">2018-03-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/07/azure-300x169.jpg" alt=""> AzureSearch过程中不能通过portal来删除indexer document中的内容。感觉非常不方便，portal只提供indexer的添加与删除。 根据项目需求需要动态add/update/delete indexer document。 MSDN中翻了很久，Azure提供了REST API和封装好的.Net SDK。 通过NuGet获取Microsoft.Azure.Search。</p>
<ol>
<li><p>publicclass PortalKBSearch    </p>
</li>
<li><p>{    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>///     The action link index client.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>privatereadonly ISearchIndexClient actionLinkIndexClient;    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// The allkb index client.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>privatereadonly ISearchIndexClient allkbIndexClient;    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>///     The bot telemetry.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>privatereadonly IBotTelemetry botTelemetry;    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>///     The _search client.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>privatereadonly ISearchServiceClient searchClient;    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Initializes a new instance of the <see cref="”PortalKBSearch”/"> class.   </see></p>
</li>
<li><p>/// Initializes a new instance of the <see cref="”PortalKBSearch”/">  </see></p>
</li>
<li><p>///     class.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”searchServiceName”">  </p>
</li>
<li><p>/// The search Service Name.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”apiKey”">  </p>
</li>
<li><p>/// The api Key.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”allKnowledgeBaseIndexName”">  </p>
</li>
<li><p>/// The all Knowledge Base Index Name.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”actionLinkIndexName”">  </p>
</li>
<li><p>/// The action Link Index Name.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <exception cref="”System.Exception”">  </exception></p>
</li>
<li><p>/// <see langword="”throw”/"> exception  </see></p>
</li>
<li><p>///   </p>
</li>
<li><p>public PortalKBSearch(    </p>
</li>
<li><p>string searchServiceName,    </p>
</li>
<li><p>string apiKey,    </p>
</li>
<li><p>string allKnowledgeBaseIndexName,    </p>
</li>
<li><p>string actionLinkIndexName)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>botTelemetry = KnowledgeBotTelemetry.CreateDefault();    </p>
</li>
<li><p>// Create an HTTP reference to the catalog index  </p>
</li>
<li><p>searchClient = new SearchServiceClient(searchServiceName, new SearchCredentials(apiKey));    </p>
</li>
<li><p>allkbIndexClient = searchClient.Indexes.GetClient(allKnowledgeBaseIndexName);    </p>
</li>
<li><p>actionLinkIndexClient = searchClient.Indexes.GetClient(actionLinkIndexName);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (Exception e)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>thrownew Exception(“Could not create PortalSearch client”, e);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>///     The run indexer.  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <returns>  </returns></p>
</li>
<li><p>///     The <see cref="”System.Threading.Tasks.Task”"> .  </see></p>
</li>
<li><p>///   </p>
</li>
<li><p>public async Task RunIndexer()    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var kbIndexers = (await searchClient.Indexers.ListAsync()).Indexers.Where(x =&gt; x.Name.StartsWith(“kb”))    </p>
</li>
<li><p>.ToArray();    </p>
</li>
<li><p>for (var i = 0; i &lt; kbIndexers.Length; i++)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>await searchClient.Indexers.RunAsync(kbIndexers[i].Name);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 创建修改索引  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”index”">  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task<indexer> CreateOrUpdateIndexer(Indexer index)    </indexer></p>
</li>
<li><p>{    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>return await searchClient.Indexers.CreateOrUpdateAsync(index);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (Exception ex)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>thrownew Exception(“Create indexer failed”, ex);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 检查索引是否存在  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”indexName”">  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task<bool> IsExistIndexer(string indexName)    </bool></p>
</li>
<li><p>{    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>return await searchClient.Indexers.ExistsAsync(indexName);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (Exception ex)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>thrownew Exception(“IsExist call failed”, ex);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 删除索引  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”indexName”">  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task DeleteIndexer(string indexName)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>await searchClient.Indexers.DeleteAsync(indexName);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (Exception ex)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>thrownew Exception(“DeleteIndexer call failed”, ex);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 创建或修改索引文档  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”model”">  </p>
</li>
<li><p>publicvoid CreateOrUpdateDocuments(List<portalkbsearchresult> model)    </portalkbsearchresult></p>
</li>
<li><p>{    </p>
</li>
<li><p>var batch = IndexBatch.MergeOrUpload(model);    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>allkbIndexClient.Documents.Index(batch);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (IndexBatchException e)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>// Sometimes when your Search service is under load, indexing will fail for some of the documents in  </p>
</li>
<li><p>// the batch. Depending on your application, you can take compensating actions like delaying and  </p>
</li>
<li><p>// retrying. For this simple demo, we just log the failed document keys and continue.  </p>
</li>
<li><p>botTelemetry.TrackException(    </p>
</li>
<li><p>new BotException { Message = $“Failed to index some of the documents:{String.Join(“, “, e.IndexingResults.Where(r =&gt; !r.Succeeded).Select(r =&gt; r.Key))}”, Error = e });    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 创建或修改索引文档  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”model”">  </p>
</li>
<li><p>publicvoid CreateOrUpdateDocumentsDynamic(List<document> model)    </document></p>
</li>
<li><p>{    </p>
</li>
<li><p>var batch = IndexBatch.MergeOrUpload(model);    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>allkbIndexClient.Documents.Index(batch);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (IndexBatchException e)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>// Sometimes when your Search service is under load, indexing will fail for some of the documents in  </p>
</li>
<li><p>// the batch. Depending on your application, you can take compensating actions like delaying and  </p>
</li>
<li><p>// retrying. For this simple demo, we just log the failed document keys and continue.  </p>
</li>
<li><p>botTelemetry.TrackException(    </p>
</li>
<li><p>new BotException { Message = $“Failed to index some of the documents:{String.Join(“, “, e.IndexingResults.Where(r =&gt; !r.Succeeded).Select(r =&gt; r.Key))}”, Error = e });    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 删除索引文档  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”model”">  </p>
</li>
<li><p>publicvoid DeleteDocuments(List<portalkbsearchresult> model)    </portalkbsearchresult></p>
</li>
<li><p>{    </p>
</li>
<li><p>var batch = IndexBatch.Delete(model);    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>allkbIndexClient.Documents.Index(batch);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (IndexBatchException e)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>// Sometimes when your Search service is under load, indexing will fail for some of the documents in  </p>
</li>
<li><p>// the batch. Depending on your application, you can take compensating actions like delaying and  </p>
</li>
<li><p>// retrying. For this simple demo, we just log the failed document keys and continue.  </p>
</li>
<li><p>botTelemetry.TrackException(    </p>
</li>
<li><p>new BotException { Message = $“Failed to delete index some of the documents:{String.Join(“, “, e.IndexingResults.Where(r =&gt; !r.Succeeded).Select(r =&gt; r.Key))}”, Error = e });    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// 删除索引文档  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”key”">  </p>
</li>
<li><p>/// <param name="”keyValues”">  </p>
</li>
<li><p>publicvoid DeleteDocuments(string key, IEnumerable<string> keyValues)    </string></p>
</li>
<li><p>{    </p>
</li>
<li><p>var batch = IndexBatch.Delete(key,keyValues);    </p>
</li>
<li><p>try</p>
</li>
<li><p>{    </p>
</li>
<li><p>allkbIndexClient.Documents.Index(batch);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>catch (IndexBatchException e)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>// Sometimes when your Search service is under load, indexing will fail for some of the documents in  </p>
</li>
<li><p>// the batch. Depending on your application, you can take compensating actions like delaying and  </p>
</li>
<li><p>// retrying. For this simple demo, we just log the failed document keys and continue.  </p>
</li>
<li><p>botTelemetry.TrackException(    </p>
</li>
<li><p>new BotException { Message = $“Failed to delete index some of the documents:{String.Join(“, “, e.IndexingResults.Where(r =&gt; !r.Succeeded).Select(r =&gt; r.Key))}”, Error = e });    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
</ol>
<p>Unit Tester:</p>
<ol>
<li><p>publicclass PortalKBSearchTests    </p>
</li>
<li><p>{    </p>
</li>
<li><p>[TestMethod()]    </p>
</li>
<li><p>publicvoid DeleteDocumentsTest()    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var searchServiceName = “{AzureSearchName}”;    </p>
</li>
<li><p>var apiKey = “{AzureSearchApiKey}”;    </p>
</li>
<li><p>var IndexName = “{AzureSearchIndexName}”;    </p>
</li>
<li><p>var actionLinkIndexName = “{AzureSearchActionLinkInxerName}”;    </p>
</li>
<li><p>var search = new PortalKBSearch(searchServiceName, apiKey, IndexName, actionLinkIndexName);    </p>
</li>
<li><p>string[] array = Array.ConvertAll(Enumerable.Range(1, 1000).ToArray(), delegate (int s) { return Convert.ToString(s); });//每次只能批量删除1000条  </p>
</li>
<li><p>search.DeleteDocuments(“QuestionId”, array);//第一个参数为筛选匹配字段  </p>
</li>
<li><p>}    </p>
</li>
<li><p>[TestMethod()]    </p>
</li>
<li><p>publicvoid CreateOrUpdateDocuments()    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var searchServiceName = “{AzureSearchName}”;    </p>
</li>
<li><p>var apiKey = “{AzureSearchApiKey}”;    </p>
</li>
<li><p>var IndexName = “{AzureSearchIndexName}”;    </p>
</li>
<li><p>var actionLinkIndexName = “{AzureSearchActionLinkInxerName}”;    </p>
</li>
<li><p>var search = new PortalKBSearch(searchServiceName, apiKey, allknowledgeBaseIndexName, actionLinkIndexName);    </p>
</li>
<li><p>var item = new Document(); //使用Document继承Dictionary  </p>
</li>
<li><p>item.Add(“{Key}”, “{object value}”);    </p>
</li>
<li><p>search.CreateOrUpdateDocuments(new List<document>().Add(item)); //SDK中同时提供List<t>入参          </t></document></p>
</li>
<li><p>}    </p>
</li>
<li><p>}</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/aud-azuresearch-indexer-document/" data-id="cjvp22zyp0006somh4wsmhmye" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure/">azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure-search/">azure search</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csharp/">csharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/document/">document</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-luis-programmatic-apis-v2-0-helper" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/luis-programmatic-apis-v2-0-helper/">LUIS Programmatic APIs v2.0 Helper</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/luis-programmatic-apis-v2-0-helper/" class="article-date">
  <time datetime="2018-02-02T13:02:41.000Z" itemprop="datePublished">2018-02-02</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/07/luis-300x125.jpg" alt=""> 最近的项目中使用了微软认知服务系列提供的Language Understanding (LUIS)服务。 鉴于每次调整LUIS都需要到luis.ai进行相关调整感觉很麻烦而且不符合项目需求。 于是将LUIS提供的REST API封装为LUIS Services Helper以供项目自身调用。 LUIS REST API Document <a href="https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5890b47c39e2bb052c5b9c2f" target="_blank" rel="noopener">请戳这里</a> Model:</p>
<ol>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Entity    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Id { get; set; }    </p>
</li>
<li><p>publicstring Name { get; set; }    </p>
</li>
<li><p>publiclong TypeId { get; set; }    </p>
</li>
<li><p>publicstring ReadableType { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>using System.Collections.Generic;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Example    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Text { get; set; }    </p>
</li>
<li><p>publicstring IntentName { get; set; }    </p>
</li>
<li><p>public IEnumerable<entitylabel> EntityLabels { get; set; }    </entitylabel></p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass JSONExample    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Text { get; set; }    </p>
</li>
<li><p>publicstring Intent { get; set; }    </p>
</li>
<li><p>public IEnumerable<entitylabel> Entities { get; set; }    </entitylabel></p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass EntityLabel    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring EntityName { get; set; }    </p>
</li>
<li><p>publicint StartCharIndex { get; set; }    </p>
</li>
<li><p>publicint EndCharIndex { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Intent    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Id { get; set; }    </p>
</li>
<li><p>publicstring Name { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>using System;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass LuisApp    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Id { get; set; }    </p>
</li>
<li><p>publicstring Name { get; set; }    </p>
</li>
<li><p>publicstring Description { get; set; }    </p>
</li>
<li><p>publicstring Culture { get; set; }    </p>
</li>
<li><p>publicstring UsageScenario { get; set; }    </p>
</li>
<li><p>publicstring Domain { get; set; }    </p>
</li>
<li><p>publicint VersionsCount { get; set; }    </p>
</li>
<li><p>public DateTime CreatedDateTime { get; set; }    </p>
</li>
<li><p>public Endpoints Endpoints { get; set; }    </p>
</li>
<li><p>publicint EndpointHitsCount { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass Endpoints    </p>
</li>
<li><p>{    </p>
</li>
<li><p>public Production Production { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass Production    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring VersionId { get; set; }    </p>
</li>
<li><p>publicbool IsStaging { get; set; }    </p>
</li>
<li><p>publicstring EndpointUrl { get; set; }    </p>
</li>
<li><p>publicstring EndpointRegion { get; set; }    </p>
</li>
<li><p>publicstring AssignedEndpointKey { get; set; }    </p>
</li>
<li><p>publicstring PublishedDateTime { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>using Newtonsoft.Json;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Publish    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring EndpointUrl { get; set; }    </p>
</li>
<li><p>[JsonProperty(“subscription-key”)]    </p>
</li>
<li><p>publicstring SubscriptionKey { get; set; }    </p>
</li>
<li><p>publicstring EndpointRegion { get; set; }    </p>
</li>
<li><p>publicbool IsStaging { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>using Newtonsoft.Json;    </p>
</li>
<li><p>using System;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Training    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring ModelId { get; set; }    </p>
</li>
<li><p>[JsonProperty(“details”)]    </p>
</li>
<li><p>public TrainingDetails Details { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass TrainingDetails    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicint StatusId { get; set; }    </p>
</li>
<li><p>publicstring Status { get; set; }    </p>
</li>
<li><p>publicint ExampleCount { get; set; }    </p>
</li>
<li><p>public DateTime? TrainingDateTime { get; set; }    </p>
</li>
<li><p>publicstring FailureReason { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis.Model    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass Utterance    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring UtteranceText { get; set; }    </p>
</li>
<li><p>publicint ExampleId { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
</ol>
<p>ServiceClient:</p>
<ol>
<li><p>using Newtonsoft.Json;    </p>
</li>
<li><p>using Newtonsoft.Json.Serialization;    </p>
</li>
<li><p>using System;    </p>
</li>
<li><p>using System.Net.Http;    </p>
</li>
<li><p>using System.Net.Http.Headers;    </p>
</li>
<li><p>using System.Text;    </p>
</li>
<li><p>using System.Threading.Tasks;    </p>
</li>
<li><p>using System.Web.Configuration;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass ServiceClient    </p>
</li>
<li><p>{    </p>
</li>
<li><p>privatestring BASE_URL = WebConfigurationManager.AppSettings[“LuisAPIDomain”] ?? “<a href="https://westus.api.cognitive.microsoft.com/luis/api/v2.0”" target="_blank" rel="noopener">https://westus.api.cognitive.microsoft.com/luis/api/v2.0”</a>;  </p>
</li>
<li><p>//private string BASE_URL = WebConfigurationManager.AppSettings[“LuisAPIDomain”] ?? “<a href="https://westus.api.cognitive.microsoft.com/luis/api/v2.0”" target="_blank" rel="noopener">https://westus.api.cognitive.microsoft.com/luis/api/v2.0”</a>;  </p>
</li>
<li><p>privatereadonlystring _subscriptionKey;    </p>
</li>
<li><p>public ServiceClient(string subscriptionKey) =&gt;    </p>
</li>
<li><p>_subscriptionKey = subscriptionKey;    </p>
</li>
<li><p>protected async Task<httpresponsemessage> Get(string path)    </httpresponsemessage></p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var client = new HttpClient())    </p>
</li>
<li><p>{    </p>
</li>
<li><p>client.DefaultRequestHeaders.Add(“Ocp-Apim-Subscription-Key”, _subscriptionKey);    </p>
</li>
<li><p>return await client.GetAsync($“{BASE_URL}{path}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>protected async Task<string> Post(string path)    </string></p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var client = new HttpClient())    </p>
</li>
<li><p>{    </p>
</li>
<li><p>client.DefaultRequestHeaders.Add(“Ocp-Apim-Subscription-Key”, _subscriptionKey);    </p>
</li>
<li><p>var response = await client.PostAsync($“{BASE_URL}{path}”, null);    </p>
</li>
<li><p>var responseContent = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return responseContent;    </p>
</li>
<li><p>else</p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(responseContent);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error?.Message ?? exception.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>protected async Task<string> Post<trequest>(string path, TRequest requestBody)    </trequest></string></p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var client = new HttpClient())    </p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var content = new ByteArrayContent(GetByteData(requestBody)))    </p>
</li>
<li><p>{    </p>
</li>
<li><p>client.DefaultRequestHeaders.Add(“Ocp-Apim-Subscription-Key”, _subscriptionKey);    </p>
</li>
<li><p>content.Headers.ContentType = new MediaTypeHeaderValue(“application/json”);    </p>
</li>
<li><p>var response = await client.PostAsync($“{BASE_URL}{path}”, content);    </p>
</li>
<li><p>var responseContent = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return responseContent;    </p>
</li>
<li><p>else</p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(responseContent);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error?.Message ?? exception.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>protected async Task Put<trequest>(string path, TRequest requestBody)    </trequest></p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var client = new HttpClient())    </p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var content = new ByteArrayContent(GetByteData(requestBody)))    </p>
</li>
<li><p>{    </p>
</li>
<li><p>client.DefaultRequestHeaders.Add(“Ocp-Apim-Subscription-Key”, _subscriptionKey);    </p>
</li>
<li><p>content.Headers.ContentType = new MediaTypeHeaderValue(“application/json”);    </p>
</li>
<li><p>var response = await client.PutAsync($“{BASE_URL}{path}”, content);    </p>
</li>
<li><p>if (!response.IsSuccessStatusCode)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var responseContent = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(responseContent);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error?.Message ?? exception.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>protected async Task Delete(string path)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>using (var client = new HttpClient())    </p>
</li>
<li><p>{    </p>
</li>
<li><p>client.DefaultRequestHeaders.Add(“Ocp-Apim-Subscription-Key”, _subscriptionKey);    </p>
</li>
<li><p>var response = await client.DeleteAsync($“{BASE_URL}{path}”);    </p>
</li>
<li><p>if (!response.IsSuccessStatusCode)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var responseContent = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(responseContent);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error?.Message ?? exception.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>privatebyte[] GetByteData<trequest>(TRequest requestBody)    </trequest></p>
</li>
<li><p>{    </p>
</li>
<li><p>var settings = new JsonSerializerSettings { ContractResolver = new CamelCasePropertyNamesContractResolver() };    </p>
</li>
<li><p>var body = JsonConvert.SerializeObject(requestBody, settings);    </p>
</li>
<li><p>return Encoding.UTF8.GetBytes(body);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
</ol>
<p>ServiceException:</p>
<ol>
<li><p>namespace KnowledgeBot.Portal.Service.Luis    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass ServiceException    </p>
</li>
<li><p>{    </p>
</li>
<li><p>public Error Error { get; set; }    </p>
</li>
<li><p>publicstring Message { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>publicclass Error    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicstring Code { get; set; }    </p>
</li>
<li><p>publicstring Message { get; set; }    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
</ol>
<p>Interface:</p>
<ol>
<li><p>using KnowledgeBot.Portal.Service.Luis.Model;    </p>
</li>
<li><p>using System.Collections.Generic;    </p>
</li>
<li><p>using System.Threading.Tasks;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service.Luis    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicinterface ILuisClientService    </p>
</li>
<li><p>{    </p>
</li>
<li><p>Task&lt;IReadOnlyCollection<luisapp>&gt; GetAllAppsAsync();    </luisapp></p>
</li>
<li><p>Task<luisapp> GetAppByIdAsync(string id);    </luisapp></p>
</li>
<li><p>Task<luisapp> GetAppByNameAsync(string name);    </luisapp></p>
</li>
<li><p>Task<string> AddAppAsync(string name, string description, string culture, string usageScenario, string domain, string initialVersionId);    </string></p>
</li>
<li><p>Task RenameAppAsync(string id, string name, string description);    </p>
</li>
<li><p>Task DeleteAppAsync(string id);    </p>
</li>
<li><p>Task&lt;IReadOnlyCollection<intent>&gt; GetAllIntentsAsync(string appId, string appVersionId);    </intent></p>
</li>
<li><p>Task<intent> GetIntentByIdAsync(string id, string appId, string appVersionId);    </intent></p>
</li>
<li><p>Task<intent> GetIntentByNameAsync(string name, string appId, string appVersionId);    </intent></p>
</li>
<li><p>Task<string> AddIntentAsync(string name, string appId, string appVersionId);    </string></p>
</li>
<li><p>Task RenameIntentAsync(string id, string name, string appId, string appVersionId);    </p>
</li>
<li><p>Task DeleteIntentAsync(string id, string appId, string appVersionId);    </p>
</li>
<li><p>Task&lt;IReadOnlyCollection<entity>&gt; GetAllEntitiesAsync(string appId, string appVersionId);    </entity></p>
</li>
<li><p>Task<entity> GetEntityByIdAsync(string id, string appId, string appVersionId);    </entity></p>
</li>
<li><p>Task<entity> GetEntityByNameAsync(string name, string appId, string appVersionId);    </entity></p>
</li>
<li><p>Task<string> AddEntityAsync(string name, string appId, string appVersionId);    </string></p>
</li>
<li><p>Task RenameEntityAsync(string id, string name, string appId, string appVersionId);    </p>
</li>
<li><p>Task DeleteEntityAsync(string id, string appId, string appVersionId);    </p>
</li>
<li><p>Task<utterance> AddExampleAsync(string appId, string appVersionId, Example model);    </utterance></p>
</li>
<li><p>Task<trainingdetails> TrainAsync(string appId, string appVersionId);    </trainingdetails></p>
</li>
<li><p>Task&lt;IEnumerable<training>&gt; GetTrainingStatusListAsync(string appId, string appVersionId);    </training></p>
</li>
<li><p>Task<publish> PublishAsync(string appId, string appVersionId, bool isStaging, string region);    </publish></p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
</ol>
<p>Interface implement:</p>
<ol>
<li><p>using KnowledgeBot.Portal.Service.Luis;    </p>
</li>
<li><p>using KnowledgeBot.Portal.Service.Luis.Model;    </p>
</li>
<li><p>using Newtonsoft.Json;    </p>
</li>
<li><p>using System;    </p>
</li>
<li><p>using System.Collections.Generic;    </p>
</li>
<li><p>using System.Linq;    </p>
</li>
<li><p>using System.Threading.Tasks;    </p>
</li>
<li><p>namespace KnowledgeBot.Portal.Service    </p>
</li>
<li><p>{    </p>
</li>
<li><p>publicclass LuisClientService : ServiceClient, ILuisClientService    </p>
</li>
<li><p>{    </p>
</li>
<li><p>public LuisClientService(string subscriptionKey) : base(subscriptionKey) {    </p>
</li>
<li><p>}    </p>
</li>
<li><p>#region Apps  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Lists all of the user applications  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <returns>A List of LUIS apps</returns>  </p>
</li>
<li><p>public async Task&lt;IReadOnlyCollection<luisapp>&gt; GetAllAppsAsync()    </luisapp></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject&lt;IReadOnlyCollection<luisapp>&gt;(content);    </luisapp></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error.Code} – {exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets the application info  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">app id  </p>
</li>
<li><p>/// <returns>LUIS app</returns>  </p>
</li>
<li><p>public async Task<luisapp> GetAppByIdAsync(string id)    </luisapp></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{id}”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<luisapp>(content);    </luisapp></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{exception.Error.Code} – {exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets the application info  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">app name  </p>
</li>
<li><p>/// <returns>LUIS app</returns>  </p>
</li>
<li><p>public async Task<luisapp> GetAppByNameAsync(string name)    </luisapp></p>
</li>
<li><p>{    </p>
</li>
<li><p>var apps = await GetAllAppsAsync();    </p>
</li>
<li><p>return apps.FirstOrDefault(app =&gt; app.Name.Equals(name));    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Creates a new LUIS app and returns the id  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">app name  </p>
</li>
<li><p>/// <param name="”description”">app description  </p>
</li>
<li><p>/// <param name="”culture”">app culture: ‘en-us’, ‘es-es’, ‘pt-br’ and others  </p>
</li>
<li><p>/// <param name="”usageScenario”">  </p>
</li>
<li><p>/// <param name="”domain”">  </p>
</li>
<li><p>/// <param name="”initialVersionId”">  </p>
</li>
<li><p>/// <returns>The ID of the created app</returns>  </p>
</li>
<li><p>public async Task<string> AddAppAsync(string name, string description, string culture, string usageScenario, string domain, string initialVersionId)    </string></p>
</li>
<li><p>{    </p>
</li>
<li><p>var app = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name,    </p>
</li>
<li><p>description = description,    </p>
</li>
<li><p>culture = culture,    </p>
</li>
<li><p>usageScenario = usageScenario,    </p>
</li>
<li><p>domain = domain,    </p>
</li>
<li><p>initialVersionId = initialVersionId    </p>
</li>
<li><p>};    </p>
</li>
<li><p>var response = await Post($“/apps”, app);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<string>(response);    </string></p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Change the name and description of LUIS app  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">app id  </p>
</li>
<li><p>/// <param name="”name”">new app name  </p>
</li>
<li><p>/// <param name="”description”">new app description  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task RenameAppAsync(string id, string name, string description)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var app = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name,    </p>
</li>
<li><p>description = description    </p>
</li>
<li><p>};    </p>
</li>
<li><p>await Put($“/apps/{id}”, app);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Deletes an application  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">app id  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task DeleteAppAsync(string id)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>await Delete($“/apps/{id}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>#region Intents  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the intent models  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>A List of app intents</returns>  </p>
</li>
<li><p>public async Task&lt;IReadOnlyCollection<intent>&gt; GetAllIntentsAsync(string appId, string appVersionId)    </intent></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{appId}/versions/{appVersionId}/intents”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject&lt;IReadOnlyCollection<intent>&gt;(content);    </intent></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{ exception.Error.Code} – { exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the intent model  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">intent id  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>app intent</returns>  </p>
</li>
<li><p>public async Task<intent> GetIntentByIdAsync(string id, string appId, string appVersionId)    </intent></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{appId}/versions/{appVersionId}/intents/{id}”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<intent>(content);    </intent></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{ exception.Error.Code} – { exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the intent model  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">intent name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>app intent</returns>  </p>
</li>
<li><p>public async Task<intent> GetIntentByNameAsync(string name, string appId, string appVersionId)    </intent></p>
</li>
<li><p>{    </p>
</li>
<li><p>var apps = await GetAllIntentsAsync(appId, appVersionId);    </p>
</li>
<li><p>return apps.FirstOrDefault(intent =&gt; intent.Name.Equals(name));    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Creates a new app intent and returns the id  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">intent name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>The ID of the created intent</returns>  </p>
</li>
<li><p>public async Task<string> AddIntentAsync(string name, string appId, string appVersionId)    </string></p>
</li>
<li><p>{    </p>
</li>
<li><p>var intent = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name    </p>
</li>
<li><p>};    </p>
</li>
<li><p>var response = await Post($“/apps/{appId}/versions/{appVersionId}/intents”, intent);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<string>(response);    </string></p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Change the name of app intent  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">intent id  </p>
</li>
<li><p>/// <param name="”name”">new intent name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task RenameIntentAsync(string id, string name, string appId, string appVersionId)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var intent = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name    </p>
</li>
<li><p>};    </p>
</li>
<li><p>await Put($“/apps/{appId}/versions/{appVersionId}/intents/{id}”, intent);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Deletes an intent classifier from the application  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">intent id  </p>
</li>
<li><p>/// <param name="”appId”">app Id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task DeleteIntentAsync(string id, string appId, string appVersionId)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>await Delete($“/apps/{appId}/versions/{appVersionId}/intents/{id}”);z    </p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>#region Entities  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the entity models  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>A List of app entities</returns>  </p>
</li>
<li><p>public async Task&lt;IReadOnlyCollection<entity>&gt; GetAllEntitiesAsync(string appId, string appVersionId)    </entity></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{appId}/versions/{appVersionId}/entities”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject&lt;IReadOnlyCollection<entity>&gt;(content);    </entity></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{ exception.Error.Code} – { exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the entity model  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">entity id  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>app entity</returns>  </p>
</li>
<li><p>public async Task<entity> GetEntityByIdAsync(string id, string appId, string appVersionId)    </entity></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{appId}/versions/{appVersionId}/entities/{id}”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<entity>(content);    </entity></p>
</li>
<li><p>elseif (response.StatusCode != System.Net.HttpStatusCode.BadRequest)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{ exception.Error.Code} – { exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>returnnull;    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets information about the entity model  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">entity name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>app entity</returns>  </p>
</li>
<li><p>public async Task<entity> GetEntityByNameAsync(string name, string appId, string appVersionId)    </entity></p>
</li>
<li><p>{    </p>
</li>
<li><p>var apps = await GetAllEntitiesAsync(appId, appVersionId);    </p>
</li>
<li><p>return apps.FirstOrDefault(Entity =&gt; Entity.Name.Equals(name));    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Creates a new app entity and returns the id  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”name”">entity name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>The ID of the created entity</returns>  </p>
</li>
<li><p>public async Task<string> AddEntityAsync(string name, string appId, string appVersionId)    </string></p>
</li>
<li><p>{    </p>
</li>
<li><p>var Entity = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name    </p>
</li>
<li><p>};    </p>
</li>
<li><p>var response = await Post($“/apps/{appId}/versions/{appVersionId}/entities”, Entity);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<string>(response);    </string></p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Change the name of app entity  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">entity id  </p>
</li>
<li><p>/// <param name="”name”">new intent name  </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task RenameEntityAsync(string id, string name, string appId, string appVersionId)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>var entity = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>name = name    </p>
</li>
<li><p>};    </p>
</li>
<li><p>await Put($“/apps/{appId}/versions/{appVersionId}/entities/{id}”, entity);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Deletes an entity extractor from the application  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”id”">entity id  </p>
</li>
<li><p>/// <param name="”appId”">app Id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns></returns>  </p>
</li>
<li><p>public async Task DeleteEntityAsync(string id, string appId, string appVersionId)    </p>
</li>
<li><p>{    </p>
</li>
<li><p>await Delete($“/apps/{appId}/versions/{appVersionId}/entities/{id}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>#region examples  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Adds a labeled example to the application  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <param name="”model”">object containing the example label  </p>
</li>
<li><p>/// <returns>A object of utterance created</returns>  </p>
</li>
<li><p>public async Task<utterance> AddExampleAsync(string appId, string appVersionId, Example model)    </utterance></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Post($“/apps/{appId}/versions/{appVersionId}/example”, model);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<utterance>(response);    </utterance></p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>#region Train  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Sends a training request for a version of a specified LUIS app  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>A object of training request details</returns>  </p>
</li>
<li><p>public async Task<trainingdetails> TrainAsync(string appId, string appVersionId)    </trainingdetails></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Post($“/apps/{appId}/versions/{appVersionId}/train”);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<trainingdetails>(response);    </trainingdetails></p>
</li>
<li><p>}    </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Gets the training status of all models (intents and entities) for the specified LUIS app  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <returns>A list of trainings status</returns>  </p>
</li>
<li><p>public async Task&lt;IEnumerable<training>&gt; GetTrainingStatusListAsync(string appId, string appVersionId)    </training></p>
</li>
<li><p>{    </p>
</li>
<li><p>var response = await Get($“/apps/{appId}/versions/{appVersionId}/train”);    </p>
</li>
<li><p>var content = await response.Content.ReadAsStringAsync();    </p>
</li>
<li><p>if (response.IsSuccessStatusCode)    </p>
</li>
<li><p>return JsonConvert.DeserializeObject&lt;IEnumerable<training>&gt;(content);    </training></p>
</li>
<li><p>else</p>
</li>
<li><p>{    </p>
</li>
<li><p>var exception = JsonConvert.DeserializeObject<serviceexception>(content);    </serviceexception></p>
</li>
<li><p>thrownew Exception($“{ exception.Error.Code} – { exception.Error.Message}”);    </p>
</li>
<li><p>}    </p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>#region Publish  </p>
</li>
<li><p>/// <summary>  </summary></p>
</li>
<li><p>/// Publishes a specific version of the application  </p>
</li>
<li><p>///   </p>
</li>
<li><p>/// <param name="”appId”">app id  </p>
</li>
<li><p>/// <param name="”appVersionId”">app version  </p>
</li>
<li><p>/// <param name="”isStaging”">  </p>
</li>
<li><p>/// <param name="”region”">If the app is created in “westeurope”, then the publish location is also “westeurope.” For all other app locations, the publish location is “westus”  </p>
</li>
<li><p>/// <returns>A object of publish details</returns>  </p>
</li>
<li><p>public async Task<publish> PublishAsync(string appId, string appVersionId, bool isStaging, string region)    </publish></p>
</li>
<li><p>{    </p>
</li>
<li><p>var model = new</p>
</li>
<li><p>{    </p>
</li>
<li><p>versionId = appVersionId,    </p>
</li>
<li><p>isStaging = isStaging.ToString(),    </p>
</li>
<li><p>region = region    </p>
</li>
<li><p>};    </p>
</li>
<li><p>var response = await Post($“/apps/{appId}/publish”, model);    </p>
</li>
<li><p>return JsonConvert.DeserializeObject<publish>(response);    </publish></p>
</li>
<li><p>}    </p>
</li>
<li><p>#endregion  </p>
</li>
<li><p>}    </p>
</li>
<li><p>}</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/luis-programmatic-apis-v2-0-helper/" data-id="cjvp22zz8000zsomhdrxy32g1" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AI/">AI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LUIS/">LUIS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REST-API/">REST API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csharp/">csharp</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-everyonehasaheartthatloveslife" class="article article-type-post" itemscope="" itemprop="blogPost" data-scroll-reveal="">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/everyonehasaheartthatloveslife/">每个人都有一颗热爱生活的心</a>
    </h2>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/everyonehasaheartthatloveslife/" class="article-date">
  <time datetime="2017-09-19T07:23:01.000Z" itemprop="datePublished">2017-09-19</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Moment/">Moment</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><img src="https://iuu.me/wp-content/uploads/2018/07/game-300x169.jpg" alt=""> (转载至某私人公众号) 很多男生都喜欢玩游戏，我也不例外，但我妈一直觉得那是不务正业。即便我现在有了体面的工作，她也仍然认为游戏是个祸害。 有天周末，我和同学约好要切磋一下。但当我神装护体带领队友冲进敌方泉水，正准备享受5杀的快感时，耳边传来了清脆的咔哒声。 我妈把网线给拔了。 “别玩啦，游戏都是小孩子玩的，你去多做点儿有意义的事嘛。” 看着我妈真挚的表情，我只好叹口气：行，妈，全听你的。今天要做啥有意义的事啊。 于是我陪我妈看了一晚上韩剧。一整晚啊思密达，真的好有意义啊思密达。 打游戏这件事，没有几个学校和家长会支持。为此我曾和网易的一位游戏策划聊过，他说游戏行业在大众心中地位不高，主要有两个原因：首先，主流媒体很少会宣扬游戏的积极意义，甚至还会刻意打压。媒体一提到“问题少年”，蹦出的三个词永远都是抽烟、打架、沉迷游戏。现在网上一搜一大把的“戒除网瘾学校”，更是把游戏描述成洪水猛兽。我这位做游戏策划的同事也深受其害，即便月薪上万，家里人也从没给过他好脸色看。因为他们觉得自己的孩子做游戏，是在害人，是要遭天谴的。 太多人对游戏有偏见了。偏见源于不理解。 你不理解男生玩游戏，就像男生不理解女生为啥爱看那些无脑的综艺节目一样。 这世界上有很多你不理解的事情，但不理解，绝不代表它就是错的。其次，游戏被妖魔化的最主要原因，是因为家长的无能。我再说一遍，是因为家长的无能。适度游戏益脑，过度游戏伤身。而很多家长不知道怎样正确引导孩子，便索性一味打压，激发出孩子的逆反心理，硬生生被逼成了所谓的网瘾少年。打游戏上瘾，是缺乏自控力的表现，而最该对孩子自控力负责的人，恰恰是家长。棋牌、金钱、烟酒、小说、男女，即便不玩游戏，我们迟也会面临更大的诱惑。而教给我们如何面对这些诱惑，安排好时间和精力，才是一位合格的家长应该做的。但他们没有，他们只会打和骂，最后把责任全部推到游戏身上。这就好比小偷被抓了，却要怪失主没把钱包放好；诈骗的落网了，却要怪被骗的人太单纯。自己教育无能，却要让游戏强行背黑锅，宝宝心里冤枉啊。 还有些学校和老师也来跟着凑热闹。辅导员夜闯宿舍活捉游戏狗，拒绝游戏从我做起。 总感觉哪里画风不对。旅游、逛街、看电影、压马路，都是放松身心、愉悦精神的消遣。可游戏也有相同的作用，又凭什么要受到打压呢。 还有人说，你个LOW逼玩什么游戏，玩得再好也不可能去参加职业比赛啊。 那我想问一句，你读个啥子书，读得再多也当不了职业作家；你看什么电视剧，阅片无数也做不成导演（AV导演你也做不成）；你听什么音乐，唱得再好也取代不了帕瓦罗蒂。 人无癖不可与交，人还是要有点儿爱好的，不管这爱好是高大上，还是接地气。只要不违法，就理应得到别人的尊重。 还有一句话很让人火大：“你要是把玩游戏的时间都用来读书、赚钱，肯定早就是成功人士了。干点儿啥不好，非要把时间荒废在游戏上？” 这位盆友，你确实是不玩游戏，可我也没见你当上成功人士啊。 这让我又想起了那个神奇的吐槽段子：</p>
<blockquote>
<p>女：你抽烟吗？ 男：抽。 女：每天多少包？ 男：三包。 女：每包多少钱？ 男：10英镑。 女：你抽烟多久了？ 男：15年。 女：所以这些年来每年你抽烟就花了10800英镑。 男：正确。 女：1年10800英镑，不考虑通货的话，过去的15年里你抽烟总共花了162000英镑对吗？ 男：嗯。 女：你知道吗？如果你没有抽烟，把这些钱放在一个高利息的储蓄账户里，按复合利率来算。你现在能买一辆法拉利了。 男：你抽烟吗？ 女：不抽。 男：那麻痹你的法拉利呢？</p>
</blockquote>
<p>游戏，是一项正大光明的爱好，与看小说和看电视剧没有任何本质区别。 《盗墓笔记》里有句话：鬼神可不信，但不可不敬。 游戏同样如此。你可以不玩游戏，但请尊重每一个游戏爱好者。因为他们与你一样，都有一颗热爱生活的心啊。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://iuu.me/everyonehasaheartthatloveslife/" data-id="cjvp22zyu000bsomh49decn1t" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/game/">game</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/habit/">habit</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
  </article>
  
  
    <nav class="page-nav">
      
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next page</a>
    </nav>
  
</section>
</div>

  <footer class="footer">
  
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2019 iUU</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="iUU"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
      <li class="nav-item">
          <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
      </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/ocean.js"></script>

</body>
</html>